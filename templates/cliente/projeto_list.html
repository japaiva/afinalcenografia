{% extends 'cliente/base_cliente.html' %}

{% block title %}Meus Projetos | Portal do Cliente | Afinal Cenografia{% endblock %}

{% block content %}
<div class="card shadow">
  <div class="card-header bg-light d-flex justify-content-between align-items-center">
    <h5 class="card-title mb-0">
      <i class="fas fa-project-diagram me-2"></i> Meus Projetos
    </h5>
    <div>
      <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#filtroModal">
        <i class="fas fa-filter me-1"></i> Filtros
      </button>
      <a href="{% url 'cliente:projeto_create' %}" class="btn btn-primary btn-sm ms-2">
        <i class="fas fa-plus-circle me-1"></i> Novo Projeto
      </a>
    </div>
  </div>
  
  <div class="card-body">
    <!-- Resumo de filtros ativos (opcional) -->
    <div class="d-flex flex-wrap gap-2 mb-3">
      <span class="badge bg-light text-dark p-2">
        Status: <strong>Todos</strong>
        <button class="btn-close btn-close-sm ms-1" style="font-size: 0.5rem;"></button>
      </span>
      <span class="badge bg-light text-dark p-2">
        Período: <strong>Último mês</strong>
        <button class="btn-close btn-close-sm ms-1" style="font-size: 0.5rem;"></button>
      </span>
    </div>

    {% if projetos %}
    <!-- Tabela de projetos -->
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th scope="col" style="width: 50px;">#</th>
            <th scope="col">Projeto</th>
            <th scope="col">Status</th>
            <th scope="col">Data Criação</th>
            <th scope="col">Projetista</th>
            <th scope="col" style="width: 150px;">Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for projeto in projetos %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>
              <div class="d-flex align-items-center">
                <div class="{% if projeto.tipo == 'evento_corporativo' %}bg-primary{% elif projeto.tipo == 'televisao' %}bg-success{% elif projeto.tipo == 'varejo' %}bg-danger{% elif projeto.tipo == 'evento_social' %}bg-purple{% else %}bg-secondary{% endif %} rounded-circle d-flex align-items-center justify-content-center text-white" style="width: 36px; height: 36px; font-size: 0.8rem; {% if projeto.tipo == 'evento_social' %}background-color: #8557e6;{% endif %}">
                  <i class="fas {% if projeto.tipo == 'evento_corporativo' %}fa-building{% elif projeto.tipo == 'televisao' %}fa-theater-masks{% elif projeto.tipo == 'varejo' %}fa-store{% elif projeto.tipo == 'evento_social' %}fa-glass-cheers{% else %}fa-project-diagram{% endif %}"></i>
                </div>
                <div class="ms-2">
                  <div class="fw-bold">{{ projeto.nome }}</div>
                  <div class="small text-muted">{{ projeto.get_tipo_display|default:"Projeto" }}</div>
                </div>
              </div>
            </td>
            <td>
              <span class="badge 
                {% if projeto.status == 'pendente' %}bg-info
                {% elif projeto.status == 'em_analise' %}bg-primary
                {% elif projeto.status == 'aprovado' %}bg-success
                {% elif projeto.status == 'em_producao' %}bg-warning text-dark
                {% elif projeto.status == 'concluido' %}bg-secondary
                {% elif projeto.status == 'cancelado' %}bg-danger
                {% else %}bg-secondary{% endif %}">
                {{ projeto.get_status_display }}
              </span>
            </td>
            <td>{{ projeto.created_at|date:"d/m/Y" }}</td>
            <td>{{ projeto.projetista.get_full_name|default:"Não atribuído" }}</td>
            <td>
              <div class="btn-group">
                <a href="{% url 'cliente:projeto_detail' pk=projeto.pk %}" class="btn btn-sm btn-outline-primary">
                  <i class="fas fa-eye"></i>
                </a>
                <a href="#" class="btn btn-sm btn-outline-success">
                  <i class="fas fa-comment"></i>
                  {% if projeto.mensagens_nao_lidas > 0 %}
                  <span class="badge bg-danger position-absolute" style="top: -5px; right: -5px; font-size: 0.6rem;">{{ projeto.mensagens_nao_lidas }}</span>
                  {% endif %}
                </a>
                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                  <i class="fas fa-ellipsis-v"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li><a class="dropdown-item" href="{% url 'cliente:projeto_update' pk=projeto.pk %}"><i class="fas fa-edit me-2"></i> Editar</a></li>
                  <li><hr class="dropdown-divider"></li>
                  <li><a class="dropdown-item text-danger" href="{% url 'cliente:projeto_delete' pk=projeto.pk %}"><i class="fas fa-trash me-2"></i> Excluir</a></li>
                </ul>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    
    <!-- Paginação -->
    {% if projetos.has_other_pages %}
    <nav aria-label="Paginação de projetos">
      <ul class="pagination justify-content-center mt-4">
        {% if projetos.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?page=1" aria-label="Primeira">
            <span aria-hidden="true">&laquo;&laquo;</span>
          </a>
        </li>
        <li class="page-item">
          <a class="page-link" href="?page={{ projetos.previous_page_number }}" aria-label="Anterior">
            <span aria-hidden="true">&laquo;</span>
          </a>
        </li>
        {% else %}
        <li class="page-item disabled">
          <span class="page-link">&laquo;&laquo;</span>
        </li>
        <li class="page-item disabled">
          <span class="page-link">&laquo;</span>
        </li>
        {% endif %}
        
        {% for i in projetos.paginator.page_range %}
          {% if projetos.number == i %}
            <li class="page-item active"><span class="page-link">{{ i }}</span></li>
          {% elif i > projetos.number|add:'-3' and i < projetos.number|add:'3' %}
            <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
          {% endif %}
        {% endfor %}
        
        {% if projetos.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ projetos.next_page_number }}" aria-label="Próxima">
            <span aria-hidden="true">&raquo;</span>
          </a>
        </li>
        <li class="page-item">
          <a class="page-link" href="?page={{ projetos.paginator.num_pages }}" aria-label="Última">
            <span aria-hidden="true">&raquo;&raquo;</span>
          </a>
        </li>
        {% else %}
        <li class="page-item disabled">
          <span class="page-link">&raquo;</span>
        </li>
        <li class="page-item disabled">
          <span class="page-link">&raquo;&raquo;</span>
        </li>
        {% endif %}
      </ul>
    </nav>
    {% endif %}
    
    {% else %}
    <!-- Mensagem quando não há projetos -->
    <div class="alert alert-info">
      <i class="fas fa-info-circle me-2"></i> Você ainda não possui projetos cadastrados.
      <a href="{% url 'cliente:projeto_create' %}" class="alert-link">Criar um novo projeto</a>.
    </div>
    {% endif %}
  </div>
</div>

<!-- Modal de Filtros -->
<div class="modal fade" id="filtroModal" tabindex="-1" aria-labelledby="filtroModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="filtroModalLabel"><i class="fas fa-filter me-2"></i> Filtrar Projetos</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <div class="row g-3">
          <!-- Status -->
          <div class="col-12">
            <label class="form-label">Status do Projeto</label>
            <div class="d-flex flex-wrap gap-2">
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" id="statusTodos" checked>
                <label class="form-check-label" for="statusTodos">Todos</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" id="statusPendente">
                <label class="form-check-label" for="statusPendente">Pendente</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" id="statusAnalise">
                <label class="form-check-label" for="statusAnalise">Em Análise</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" id="statusAprovado">
                <label class="form-check-label" for="statusAprovado">Aprovado</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" id="statusProducao">
                <label class="form-check-label" for="statusProducao">Em Produção</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" id="statusConcluido">
                <label class="form-check-label" for="statusConcluido">Concluído</label>
              </div>
            </div>
          </div>
          
          <!-- Categoria -->
          <div class="col-md-12">
            <label for="filtroCategoria" class="form-label">Categoria</label>
            <select class="form-select" id="filtroCategoria">
              <option value="" selected>Todas as Categorias</option>
              <option value="evento_corporativo">Evento Corporativo</option>
              <option value="evento_social">Evento Social</option>
              <option value="televisao">Televisão</option>
              <option value="varejo">Varejo</option>
              <option value="teatro">Teatro</option>
              <option value="outros">Outros</option>
            </select>
          </div>
          
          <!-- Período -->
          <div class="col-12">
            <label class="form-label">Período de Criação</label>
            <div class="row g-2">
              <div class="col-md-6">
                <input type="date" class="form-control" placeholder="Data Inicial">
              </div>
              <div class="col-md-6">
                <input type="date" class="form-control" placeholder="Data Final">
              </div>
            </div>
          </div>
          
          <!-- Ordenação -->
          <div class="col-12">
            <label for="filtroOrdenacao" class="form-label">Ordenar por</label>
            <select class="form-select" id="filtroOrdenacao">
              <option value="1" selected>Data de Criação (mais recente)</option>
              <option value="2">Data de Criação (mais antigo)</option>
              <option value="3">Nome do Projeto (A-Z)</option>
              <option value="4">Status</option>
            </select>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-outline-secondary">Limpar Filtros</button>
        <button type="button" class="btn btn-primary">Aplicar Filtros</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}