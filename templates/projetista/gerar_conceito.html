{% extends 'projetista/base_projetista.html' %}

{% block title %}Gerar Conceito Visual | Portal do Projetista{% endblock %}

{% block content %}
<div class="card shadow mb-4">
  <div class="card-header bg-light d-flex justify-content-between align-items-center">
    <h5 class="card-title mb-0">
      <i class="fas fa-lightbulb me-2"></i> Gerar Conceito Visual para o Projeto: {{ projeto.nome }}
    </h5>
    <a href="{% url 'projetista:projeto_detail' pk=projeto.id %}" class="btn btn-outline-secondary btn-sm">
      <i class="fas fa-arrow-left me-1"></i> Voltar
    </a>
  </div>
  
  <div class="card-body">
    <div class="alert alert-info">
      <i class="fas fa-info-circle me-2"></i> Nesta página você pode criar um conceito visual baseado no briefing do cliente. Utilize as informações e referências fornecidas para elaborar sua proposta.
    </div>
    
    <!-- Resumo do Briefing -->
    <div class="card mb-4">
      <div class="card-header bg-light">
        <h6 class="mb-0">Resumo do Briefing</h6>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <p><strong>Empresa:</strong> {{ projeto.empresa.nome }}</p>
            <p><strong>Objetivo do Estande:</strong> {{ briefing.objetivo_estande|truncatechars:150 }}</p>
            <p><strong>Estilo do Estande:</strong> {{ briefing.estilo_estande|default:"Não informado" }}</p>
          </div>
          <div class="col-md-6">
            <p><strong>Área Total:</strong> {{ briefing.area_estande|default:"Não informado" }} m²</p>
            <p><strong>Material Principal:</strong> {{ briefing.get_material_display|default:"Não informado" }}</p>
            <p><strong>Status:</strong> <span class="badge bg-success">{{ briefing.get_status_display }}</span></p>
          </div>
        </div>
        <div class="mt-2">
          <a href="{% url 'projetista:ver_briefing' projeto_id=projeto.id %}" class="btn btn-outline-primary btn-sm">
            <i class="fas fa-eye me-1"></i> Ver Briefing Completo
          </a>
        </div>
      </div>
    </div>
    
    <!-- Formulário para o Conceito Visual -->
    <form method="post" action="{% url 'projetista:salvar_conceito' projeto_id=projeto.id %}" enctype="multipart/form-data">
      {% csrf_token %}
      
      <div class="card mb-4">
        <div class="card-header bg-light">
          <h6 class="mb-0">Conceito Visual</h6>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <label for="descricao" class="form-label">Descrição do Conceito</label>
            <textarea id="descricao" name="descricao" class="form-control" rows="6" required>{{ form_data.descricao|default:'' }}</textarea>
            <div class="form-text">Descreva em detalhes o conceito visual que você está propondo. Explique sua ideia, materiais, cores e elementos-chave.</div>
          </div>
          
          <div class="mb-3">
            <label for="referencias_utilizadas" class="form-label">Referências Utilizadas</label>
            <textarea id="referencias_utilizadas" name="referencias_utilizadas" class="form-control" rows="4">{{ form_data.referencias_utilizadas|default:'' }}</textarea>
            <div class="form-text">Liste as referências que você utilizou para criar este conceito (podem ser referências anexadas pelo cliente ou pesquisadas por você).</div>
          </div>
          
          <div class="mb-3">
            <label for="imagens_conceito" class="form-label">Imagens do Conceito</label>
            <input type="file" id="imagens_conceito" name="imagens_conceito" class="form-control" multiple accept="image/*">
            <div class="form-text">Faça upload de renders, sketches, moodboards ou qualquer outra imagem que represente seu conceito.</div>
          </div>
        </div>
      </div>
      
      <!-- Referências do Cliente -->
      <div class="card mb-4">
        <div class="card-header bg-light">
          <h6 class="mb-0">Referências do Cliente</h6>
        </div>
        <div class="card-body">
          <div class="row row-cols-1 row-cols-md-3 g-4">
            {% for arquivo in arquivos %}
              {% if arquivo.tipo == 'referencia' or arquivo.tipo == 'campanha' or arquivo.tipo == 'logo' %}
                <div class="col">
                  <div class="card h-100">
                    <img src="{{ arquivo.arquivo.url }}" class="card-img-top" alt="{{ arquivo.nome }}" style="height: 150px; object-fit: cover;">
                    <div class="card-body">
                      <h6 class="card-title">{{ arquivo.nome }}</h6>
                      <p class="card-text small">{{ arquivo.get_tipo_display }}</p>
                      <a href="{{ arquivo.arquivo.url }}" class="btn btn-sm btn-outline-primary" target="_blank">
                        <i class="fas fa-search me-1"></i> Ampliar
                      </a>
                    </div>
                  </div>
                </div>
              {% endif %}
            {% endfor %}
            
            {% if not arquivos %}
              <div class="col-12 text-center py-4">
                <p class="text-muted mb-0">Nenhuma referência visual fornecida pelo cliente.</p>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
      
      <!-- Botões de Ação -->
      <div class="d-flex justify-content-end">
        <button type="button" class="btn btn-outline-secondary me-2" onclick="window.history.back();">Cancelar</button>
        <button type="submit" class="btn btn-primary">
          {% if conceito %}
            <i class="fas fa-save me-1"></i> Atualizar Conceito
          {% else %}
            <i class="fas fa-save me-1"></i> Salvar Conceito
          {% endif %}
        </button>
      </div>
    </form>
  </div>
</div>

{% if conceito and conceito.imagens.exists %}
<div class="card shadow mb-4">
  <div class="card-header bg-light">
    <h5 class="card-title mb-0">
      <i class="fas fa-images me-2"></i> Imagens do Conceito Atual
    </h5>
  </div>
  <div class="card-body">
    <div class="row row-cols-1 row-cols-md-3 g-4">
      {% for imagem in conceito.imagens.all %}
        <div class="col">
          <div class="card h-100">
            <img src="{{ imagem.imagem.url }}" class="card-img-top" alt="Imagem do Conceito {{ forloop.counter }}" style="height: 200px; object-fit: cover;">
            <div class="card-body">
              <h6 class="card-title">Imagem {{ forloop.counter }}</h6>
              {% if imagem.descricao %}
                <p class="card-text small">{{ imagem.descricao }}</p>
              {% endif %}
              <a href="{{ imagem.imagem.url }}" class="btn btn-sm btn-outline-primary" target="_blank">
                <i class="fas fa-search me-1"></i> Ampliar
              </a>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>
</div>
{% endif %}
{% endblock %}